## Opsummering

De fejl, du oplever, skyldes primært, at dine workspaces mangler nødvendige dependencies eller korrekt konfiguration under Yarn Plug’n’Play:

1. **Create-solid-wow** rammes af `TS2318: Cannot find global type 'Array'…` fordi TypeScript-bibliotekerne (`lib.es2018.d.ts` mv.) ikke bliver fundet i det pågældende workspace.
2. **API-workspace** fejler med `Module not found: Error: Can't resolve 'ts-loader'` og `webpack/hot/poll?100` fordi `ts-loader` har `webpack` som peer-dependency, og hot-poll-loaderen ikke er installeret.
3. **Web-workspace** slår fejl på `next-route-loader` og “No file content” for `apps/web/package.json`, da `next` ikke er deklareret som dependency, og package.json enten mangler eller er tom.

Nedenfor gennemgår jeg hver fejl med årsag og konkrete rettelser.

---

## 1. Create-solid-wow: Manglende globale TypeScript-typer

### Årsag

Når du specificerer `"lib": ["es2018"]` i `tsconfig.json`, fraskriver TypeScript sig automatisk standard-bibliotekerne (som `es5`, `dom` osv.) ([Stack Overflow][1], [Medium][2]). Samtidig mangler workspace’et `typescript` som lokal dependency, så TS-pakken (og dermed `lib.es2018.d.ts`) ikke kan opløses under PnP ([GitHub][3], [johnnyreilly.com][4]).

### Løsning

1. **Tilføj `typescript` som dev-dependency** i `packages/create-solid-wow`:

   ```bash
   yarn workspace create-solid-wow add -D typescript@latest
   yarn workspace create-solid-wow add -D @types/node
   ```
2. **Udvid `tsconfig.json`’s `lib`** for også at inkludere de manglende biblioteker:

   ```json
   {
     "compilerOptions": {
       "lib": ["es2018", "dom", "esnext"],
       // eller fjern helt `lib`-feltet for at bruge standarderne
     }
   }
   ```

   Dermed får du både ES-standardtyperne og DOM-typerne tilbage ([Stack Overflow][1], [youtrack.jetbrains.com][5]).

Efter disse tiltag vil globale typer som `Array`, `Boolean` osv. genkendes uden fejl ([GitHub][3], [dirask.com][6]).

---

## 2. API-workspace: `ts-loader` og Hot-Polling

### Årsag

* **`ts-loader`** afhænger af `webpack` som peer-dependency og kan derfor ikke løses, når `webpack` ikke er deklareret i `apps/api/package.json` ([Stack Overflow][7]).
* **`webpack/hot/poll?100`** er en del af Webpacks HMR-funktionalitet, som ikke findes, hvis `webpack-dev-server` eller relaterede HMR-pakker mangler.

### Løsning

1. **Installer `ts-loader`, `webpack` og relaterede HMR-pakker** i `apps/api`:

   ```bash
   yarn workspace api add -D \
     webpack webpack-cli ts-loader \
     webpack-dev-server webpack-hot-middleware
   ```
2. **Opdater din `webpack.config.js`** til at bruge PnP-plugin’et og hot-middleware:

   ```js
   const PnpWebpackPlugin = require('pnp-webpack-plugin');

   module.exports = {
     // ...
     resolve: {
       plugins: [PnpWebpackPlugin],
     },
     module: {
       rules: [
         {
           test: /\.tsx?$/,
           use: 'ts-loader',
           exclude: /node_modules/,
         },
       ],
     },
     plugins: [
       // HMR-plugin
       new webpack.HotModuleReplacementPlugin(),
     ],
     entry: ['webpack/hot/poll?100', './src/index.ts'],
   };
   ```
3. **Kør derefter**:

   ```bash
   yarn workspace api run dev
   ```

Herefter vil både `ts-loader` og HMR (`hot/poll`) blive fundet korrekt ([Stack Overflow][7], [webpack][8]).

---

## 3. Web-workspace: `next-route-loader` og package.json

### Årsag

* Fejlen **“No file content”** tyder på, at `apps/web/package.json` enten er tom eller ustøttet af PnP, så Next.js ikke kan indlæse sin egen loader.
* `next-route-loader` er en intern del af Next.js og kræver, at `next` er deklareret i `dependencies` ([Next.js][9]).

### Løsning

1. **Genskab eller opret `apps/web/package.json`** med mindst følgende:

   ```json
   {
     "name": "web",
     "version": "1.0.0",
     "private": true,
     "dependencies": {
       "next": "13.4.12",
       "react": "18.x",
       "react-dom": "18.x"
     },
     "scripts": {
       "dev": "next dev",
       "build": "next build",
       "start": "next start",
       "lint": "next lint"
     }
   }
   ```
2. **Installer pakkerne**:

   ```bash
   yarn workspace web install
   ```
3. **Bekræft med** `yarn workspace web run dev`
   Nu kan Next.js finde både `next-route-loader` og den lokale `package.json` korrekt under PnP ([Next.js][9], [Yarn][10]).

---

## 4. Validering

1. Kør **`yarn turbo run lint`** igen for at sikre, at alle lint-fejl er væk.
2. Start dev-serverne med **`yarn workspace api run dev`** og **`yarn workspace web run dev`** for at bekræfte, at både API og frontend kører uden missing-module-fejl.
3. Bekræft, at **TypeScript-kompilering** i `create-solid-wow` ikke længere giver `TS2318`-fejl.

Med disse ændringer vil dit monorepo være korrekt konfigureret til Yarn PnP, og de nævnte API- og build-fejl vil være løst. Lad mig endelig vide, hvis der opstår nye problemer!

[1]: https://stackoverflow.com/questions/50721103/error-ts2318-cannot-find-global-type-object?utm_source=chatgpt.com "error TS2318: Cannot find global type 'Object' - Stack Overflow"
[2]: https://medium.com/%40turingvang/ts2318-cannot-find-global-type-0-0c9c5f77286b?utm_source=chatgpt.com "TS2318: Cannot find global type '{0}' | by Turingvang - Medium"
[3]: https://github.com/Microsoft/TypeScript/issues/12711?utm_source=chatgpt.com "Cannot find global type 'Array', plus many more Type Errors #12711"
[4]: https://johnnyreilly.com/typescript-webpack-you-down-with-pnp?utm_source=chatgpt.com "TypeScript / webpack - you down with PnP? Yarn, you know me!"
[5]: https://youtrack.jetbrains.com/issue/WEB-18078/Error-TS2318-using-TypeScript-with-nolib-in-IDEA?utm_source=chatgpt.com "Error: TS2318 using TypeScript (with --nolib) in IDEA : WEB-18078"
[6]: https://dirask.com/questions/TypeScript-error-TS2318-Cannot-find-global-type-Array-1RPqdp?utm_source=chatgpt.com "TypeScript - error TS2318: Cannot find global type 'Array' - Dirask"
[7]: https://stackoverflow.com/questions/65923713/migration-from-npm-to-yarn-2-pnp-ts-loader-doesnt-find-webpack?utm_source=chatgpt.com "Migration from npm to Yarn 2 PnP: ts-loader doesn't find webpack"
[8]: https://webpack.js.org/guides/hot-module-replacement/?utm_source=chatgpt.com "Hot Module Replacement - webpack"
[9]: https://nextjs.org/docs/messages/module-not-found?utm_source=chatgpt.com "Module Not Found | Next.js"
[10]: https://yarnpkg.com/features/pnp?utm_source=chatgpt.com "Yarn Plug'n'Play"
